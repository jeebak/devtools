<?xml version="1.0"?>
<root>

  <!-- For "Mouse Keys Mode v3" -->

  <!-- From: src/core/server/Resources/modifierdef.xml -->
  <modifierdef>MOUSE_KEYS_MODE_3</modifierdef>
  <modifierdef>MOUSE_KEYS_MODE_3_SCROLL</modifierdef>

  <!-- From: src/core/server/Resources/replacementdef.xml -->
  <replacementdef>
    <replacementname>MOUSE_KEYS_MODE_3_CONDITION</replacementname>
    <replacementvalue>
      <![CDATA[
               <!-- Disable Mouse Keys Mode v3 when any modifiers are pressed in order to keep control-D key repeat. -->
               <modifier_not>
                 ModifierFlag::COMMAND_L,
                 ModifierFlag::COMMAND_R,
                 ModifierFlag::CONTROL_L,
                 ModifierFlag::CONTROL_R,
                 ModifierFlag::FN,
                 ModifierFlag::OPTION_L,
                 ModifierFlag::OPTION_R,
                 ModifierFlag::SHIFT_L,
                 ModifierFlag::SHIFT_R,
               </modifier_not>
               ]]>
    </replacementvalue>
  </replacementdef>

  <replacementdef>
    <replacementname>MOUSE_KEYS_MODE_3_EXTRA</replacementname>
    <replacementvalue></replacementvalue>
  </replacementdef>

  <item>
    <name>My TouchCursor Mouse Keys</name>
    <item>
      <name style="important">Important:</name>
      <appendix>At least one pointing device must be connected when you use Mouse Keys.</appendix>
      <appendix>(Excluded devices by "Karabiner core settings > Exclude devices" are not counted.)</appendix>
    </item>

    <item>
      <name>Mouse Keys Mode v3</name>
      <appendix>You can move mouse pointer by d+hjkl keys, and scroll by d+s+hjkl keys.</appendix>
      <appendix></appendix>
      <appendix>Usage:</appendix>
      <appendix></appendix>
      <appendix>Move pointer by:</appendix>
      <appendix><![CDATA[  * Left: D down -> H down -> H up  ]]></appendix>
      <appendix><![CDATA[  * Down: D down -> J down -> J up  ]]></appendix>
      <appendix><![CDATA[  * Up: D down -> K down -> K up  ]]></appendix>
      <appendix><![CDATA[  * Right: D down -> L down -> L up  ]]></appendix>
      <appendix></appendix>
      <appendix>The hjkl keys also act as mouse keys when you hold d+hjkl keys down.</appendix>
      <appendix>(You can adjust timeout by "__BlockUntilKeyUp__ Timeout" in Parameters tab.</appendix>
      <appendix></appendix>
      <appendix>Use S key to enable scroll. ("S"croll)</appendix>
      <appendix>* D+S+HJKL: Scroll wheel.</appendix>
      <appendix></appendix>
      <appendix>Use F key to increase speed. ("F"ast)</appendix>
      <appendix>* D+F+HJKL: High-speed movement.</appendix>
      <appendix>* D+F+S+HJKL: High-speed scroll wheel.</appendix>
      <appendix></appendix>
      <appendix>Click by:</appendix>
      <appendix>* D+V: Left click.</appendix>
      <appendix>* D+B: Middle click.</appendix>
      <appendix>* D+N: Right click.</appendix>
      <appendix></appendix>
      <appendix>Warp cursor position:</appendix>
      <appendix>* D+I: Move mouse cursor to the center of the frontmost app's window.</appendix>
      <identifier>remap.mouse_keys_mode_3</identifier>

      {{ MOUSE_KEYS_MODE_3_CONDITION }}

      <autogen>
        __KeyOverlaidModifier__
        KeyCode::D,

        <!--
            Use notsave.mouse_keys_mode_3 in order to be higher priority.
            Use ModifierFlag::MOUSE_KEYS_MODE_3 for __DropAllKeys__.
        -->
        @begin
        KeyCode::VK_CONFIG_FORCE_ON_notsave_mouse_keys_mode_3,
        KeyCode::VK_MODIFIER_MOUSE_KEYS_MODE_3,
        @end

        @begin
        KeyCode::D,
        @end
      </autogen>
    </item>
    <item hidden="true">
      <identifier vk_config="true">notsave.mouse_keys_mode_3</identifier>
      <modifier_only>ModifierFlag::MOUSE_KEYS_MODE_3</modifier_only>

      {{ MOUSE_KEYS_MODE_3_EXTRA }}

      <autogen>
        __BlockUntilKeyUp__ KeyCode::D
      </autogen>

      <!-- scroll -->
      <block>
        <modifier_only>ModifierFlag::MOUSE_KEYS_MODE_3_SCROLL</modifier_only>
        <autogen>
          __KeyToKey__
          {{ VI_H }},
          KeyCode::VK_MOUSEKEY_SCROLL_LEFT, ModifierFlag::MOUSE_KEYS_MODE_3,
        </autogen>
        <autogen>
          __KeyToKey__
          {{ VI_J }},
          KeyCode::VK_MOUSEKEY_SCROLL_DOWN, ModifierFlag::MOUSE_KEYS_MODE_3,
        </autogen>
        <autogen>
          __KeyToKey__
          {{ VI_K }},
          KeyCode::VK_MOUSEKEY_SCROLL_UP, ModifierFlag::MOUSE_KEYS_MODE_3,
        </autogen>
        <autogen>
          __KeyToKey__
          {{ VI_L }},
          KeyCode::VK_MOUSEKEY_SCROLL_RIGHT, ModifierFlag::MOUSE_KEYS_MODE_3,
        </autogen>
      </block>

      <!-- mouse move -->
      <autogen>__KeyToKey__ {{ VI_H }}, KeyCode::VK_MOUSEKEY_LEFT,  ModifierFlag::MOUSE_KEYS_MODE_3</autogen>
      <autogen>__KeyToKey__ {{ VI_J }}, KeyCode::VK_MOUSEKEY_DOWN,  ModifierFlag::MOUSE_KEYS_MODE_3</autogen>
      <autogen>__KeyToKey__ {{ VI_K }}, KeyCode::VK_MOUSEKEY_UP,    ModifierFlag::MOUSE_KEYS_MODE_3</autogen>
      <autogen>__KeyToKey__ {{ VI_L }}, KeyCode::VK_MOUSEKEY_RIGHT, ModifierFlag::MOUSE_KEYS_MODE_3</autogen>

      <!-- other -->
      <autogen>__KeyToKey__ KeyCode::S, KeyCode::VK_MODIFIER_MOUSE_KEYS_MODE_3_SCROLL, ModifierFlag::MOUSE_KEYS_MODE_3</autogen>
      <autogen>__KeyToKey__ KeyCode::F, KeyCode::VK_MOUSEKEY_HIGHSPEED, ModifierFlag::MOUSE_KEYS_MODE_3</autogen>

      <!-- click -->
      <autogen>__KeyToKey__ KeyCode::V, PointingButton::LEFT,   ModifierFlag::MOUSE_KEYS_MODE_3</autogen>
      <autogen>__KeyToKey__ KeyCode::B, PointingButton::MIDDLE, ModifierFlag::MOUSE_KEYS_MODE_3</autogen>
      <autogen>__KeyToKey__ KeyCode::N, PointingButton::RIGHT,  ModifierFlag::MOUSE_KEYS_MODE_3</autogen>

      <!-- warp cursor position -->
      <autogen>__KeyToKey__ KeyCode::I, KeyCode::VK_OPEN_URL_SHELL_warp_mouse_cursor_position_front_window_center</autogen>

      <autogen>
        __DropAllKeys__
        ModifierFlag::MOUSE_KEYS_MODE_3,

        Option::DROPALLKEYS_DROP_KEY,
      </autogen>
    </item>
  </item>
</root>
